{% extends "data/download_base.html" %}

{% block version_specific_controls %}
<div class="flex flex-col items-center gap-4">

  <select id="versionSelect" class="select select-primary w-28">
    <option value="v0.2" selected>v0.2</option>
    <option value="v0.1">v0.1</option>
  </select>

  <div id="searchControls" class="flex flex-wrap justify-center gap-5 mt-3">
    <div>
        <input type="text" id="nutsCodeInput" list="nutsCodeOptions" class="input input-md input-primary min-w-[14rem]" placeholder="Search by NUTS code (e.g., DE, DE1, DE12)">
        <datalist id="nutsCodeOptions"></datalist>
    </div>
    <div id="orSeparator" class="flex items-center text-gray-400 font-semibold mx-2 text-md">
      — OR —
    </div>
    <div>
        <input type="text" id="nutsNameInput" list="nutsNameOptions" class="input input-md input-primary min-w-[14rem]" placeholder="Search by region name (e.g., Baden-Württemberg)">
        <datalist id="nutsNameOptions"></datalist>
    </div>
  </div>
</div>
{% endblock %}

{% block version_specific_table %}
<div class="mt-8 border-base-content/10 rounded-lg bg-base-100">
  <div class="overflow-x-auto overflow-y-auto max-h-[500px] relative custom-scrollbar">
    <table id="downloadsTable" class="table table-compact w-full table-fixed text-sm border-separate border-spacing-0">

      <thead>
        <tr class="sticky top-0 z-40">
          <th class="w-[15%] bg-base-200 border-b border-base-content/10 py-3">NUTS ID</th>
          <th class="w-[30%] bg-base-200 border-b border-base-content/10 py-3">Name</th>

          <th class="w-[18%] bg-base-200 border-b border-base-content/10 py-3 text-center">
            <span class="tooltip tooltip-bottom inline-flex items-center gap-1 cursor-help normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="RECOMMENDED: Strict typing, rich metadata, and high compression.">
              Parquet <span class="badge badge-success badge-xs">!</span>
            </span>
          </th>

          <th class="w-[18%] bg-base-200 border-b border-base-content/10 py-3 text-center">
            <span class="tooltip tooltip-bottom inline-flex items-center gap-1 cursor-help normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="EXPERIMENTAL: Converted from Parquet. Minor typing discrepancies expected.">
              GPKG <span class="badge badge-warning badge-xs">⚠</span>
            </span>
          </th>

          <th class="w-[19%] bg-base-200 border-b border-base-content/10 py-3 text-center">
            <span class="tooltip tooltip-bottom inline-flex items-center gap-1 cursor-help normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="EXPERIMENTAL: Converted from Parquet. Minor typing discrepancies expected. Shortened column names. Individual files may exceed 2GB legacy cap.">
              SHP <span class="badge badge-warning badge-xs">⚠</span>
            </span>
          </th>
        </tr>
      </thead>

      <tbody id="downloadsBody">
        <tr>
          <td colspan="5" class="text-center py-12 italic opacity-40">
            Select a region on the map or search above.
          </td>
        </tr>
      </tbody>

      <tfoot class="sticky bottom-0 z-30 bg-base-100 border-t border-base-content/20">
        <tr class="bg-base-100">
          <td colspan="2" class="py-3 font-bold text-[10px] uppercase tracking-widest">
            {% comment %} Bundle results: {% endcomment %}
          </td>
          <td class="text-center py-3">
            <div class="tooltip tooltip-top w-full normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="Download all results as Parquet (.zip)">
              <button id="btnParquet" class="btn btn-xs btn-ghost border-base-content/20 w-full max-w-[90px]" disabled>All</button>
            </div>
          </td>
          <td class="text-center py-3">
            <div class="tooltip tooltip-top w-full normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="Download all results as GeoPackage (.zip)">
              <button id="btnGpkg" class="btn btn-xs btn-ghost border-base-content/20 w-full max-w-[90px]" disabled>All</button>
            </div>
          </td>
          <td class="text-center py-3">
            <div class="tooltip tooltip-top w-full normal-case font-normal tracking-normal whitespace-normal max-w-xs" data-tip="Download all results as Shapefile (.zip)">
              <button id="btnShp" class="btn btn-xs btn-ghost border-base-content/20 w-full max-w-[90px]" disabled>All</button>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<style>
  /* Prevents tooltips from being cut off by the container */
  .tooltip:before, .tooltip:after {
    z-index: 50 !important;
  }

  /* Modern minimal scrollbar */
  .custom-scrollbar::-webkit-scrollbar { width: 4px; }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: hsl(var(--bc) / 0.2);
    border-radius: 10px;
  }

  /* Tooltip width management */
  .tooltip:before {
    white-space: normal;
    width: 160px;
    text-align: center;
  }
</style>
{% endblock %}
